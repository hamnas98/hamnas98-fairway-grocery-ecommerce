<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description-gambolthemes" content="">
		<meta name="author-gambolthemes" content="">
		<title>Fairway Supermarket Admin</title>
		<link href="css/styles.css" rel="stylesheet">
		<link href="css/admin-style.css" rel="stylesheet">
		<link href="css/admin-custom" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<link  href="/admin/css/order.css"  rel="stylesheet">
		<style>
			/* inventory.css */
.inventory-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding: 1rem;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.header-left {
    flex: 1;
}

.page-title {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: #2b2f4c;
}

.inventory-stats {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.stat-card {
    flex: 1;
    display: flex;
    align-items: center;
    padding: 1rem;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-2px);
}

.stat-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    margin-right: 1rem;
    font-size: 1.25rem;
}

.stat-icon.low {
    background: #fff3e0;
    color: #f57c00;
}

.stat-icon.out {
    background: #ffebee;
    color: #d32f2f;
}

.stat-icon.total {
    background: #e8f5e9;
    color: #388e3c;
}

.stat-info {
    flex: 1;
}

.stat-label {
    display: block;
    font-size: 0.875rem;
    color: #666;
    margin-bottom: 0.25rem;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2b2f4c;
    margin: 0;
}

.header-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.search-box {
    position: relative;
    width: 300px;
}

.search-box i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
}

.search-box input {
    width: 100%;
    padding: 0.5rem 1rem 0.5rem 2.5rem;
    border: 1px solid #ddd;
    border-radius: 6px;
}

.filter-group select {
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    color: #2b2f4c;
}

/* Table Styles */
.inventory-table {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    overflow: hidden;
}

.table {
    margin: 0;
}

.table thead th {
    background: #f8f9fa;
    border-bottom: 2px solid #eef0f5;
    color: #2b2f4c;
    font-weight: 600;
    padding: 1rem;
}

.product-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.product-img {
    width: 48px;
    height: 48px;
    object-fit: cover;
    border-radius: 6px;
}

.stock-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
}

.badge-danger {
    background: #ffebee;
    color: #d32f2f;
}

.badge-warning {
    background: #fff3e0;
    color: #f57c00;
}

.badge-success {
    background: #e8f5e9;
    color: #388e3c;
}

/* Row highlighting */
.out-of-stock {
    background: #fff5f5;
}

.low-stock {
    background: #fff8e1;
}

/* Button Styles */
.btn-export {
    padding: 0.5rem 1rem;
    background: #2b2f4c;
    color: white;
    border: none;
    border-radius: 6px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-export:hover {
    background: #1a1c2e;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .inventory-stats {
        flex-direction: column;
    }
    
    .header-actions {
        flex-direction: column;
        width: 100%;
    }
    
    .search-box {
        width: 100%;
    }
}
			</style>
		
		<!-- Vendor Stylesheets -->
		<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
		
	</head>

    <body class="sb-nav-fixed">
		<%- include('../partials/admin/topnav') %>
        <div id="layoutSidenav">
			<%- include('../partials/admin/sidebar') %>
            <div id="layoutSidenav_content">
                <main>
					<div class="container-fluid">
						<h2 class="mt-30 page-title">Orders</h2>
						<ol class="breadcrumb mb-30">
							<li class="breadcrumb-item"><a href="/admin/dashboard">Dashboard</a></li>
							<li class="breadcrumb-item active">Orders</li>
						</ol>
					
						<!-- views/admin/inventory.ejs -->
<div class="container-fluid">
    <div class="inventory-header">
        <div class="header-left">
            <h2 class="page-title">Inventory Management</h2>
            <div class="inventory-stats">
                <div class="stat-card" onclick="filterByStock('low')" style="cursor: pointer;">
                    <div class="stat-icon low">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Low Stock</span>
                        <h3 class="stat-value"><%= lowStockCount %></h3>
                    </div>
                </div>
                <div class="stat-card" onclick="filterByStock('out')" style="cursor: pointer;">
                    <div class="stat-icon out">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Out of Stock</span>
                        <h3 class="stat-value"><%= outOfStockCount %></h3>
                    </div>
                </div>
                <div class="stat-card" onclick="filterByStock('all')" style="cursor: pointer;">
                    <div class="stat-icon total">
                        <i class="fas fa-cube"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Total Products</span>
                        <h3 class="stat-value"><%= totalProducts %></h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-actions">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="inventorySearch" placeholder="Search products...">
            </div>
            <div class="filter-group">
                <select id="stockStatus" onchange="filterInventory()">
                    <option value="all">All Products</option>
                    <option value="instock">In Stock</option>
                    <option value="lowstock">Low Stock</option>
                    <option value="outofstock">Out of Stock</option>
                </select>
            </div>
            <div class="filter-group">
                <select id="categoryFilter" onchange="filterInventory()">
                    <option value="all">All Categories</option>
                    <% categories.forEach(category => { %>
                        <option value="<%= category._id %>"><%= category.name %></option>
                    <% }); %>
                </select>
            </div>
            <button class="btn btn-export" onclick="exportInventory()">
                <i class="fas fa-file-download"></i> Export
            </button>
        </div>
    </div>

    <div class="inventory-table">
        <table class="table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Category</th>
                    <th>Stock Status</th>
                    <th>Available Stock</th>
                    <th>Price</th>
                    <th>Last Updated</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% products.forEach(product => { %>
                    <tr class="<%= getStockClass(product.stock) %>">
                        <td class="product-info">
                            <img src="<%= product.images[0] %>" alt="<%= product.name %>" class="product-img">
                            <div>
                                <h6><%= product.name %></h6>
                                <small class="text-muted">SKU: <%= product.sku %></small>
                            </div>
                        </td>
                        <td><%= product.category.name %></td>
                        <td>
                            <span class="stock-badge <%= getStockBadgeClass(product.stock) %>">
                                <%= getStockStatus(product.stock) %>
                            </span>
                        </td>
                        <td>
                            <div class="stock-count">
                                <span class="<%= getStockTextClass(product.stock) %>">
                                    <%= product.stock %>
                                </span>
                                <small><%= product.unit %></small>
                            </div>
                        </td>
                        <td>
                            <div class="price-info">
                                ₹<%= product.price %>
                                <% if(product.discountPrice) { %>
                                    <small class="text-success">
                                        (₹<%= product.discountPrice %> after discount)
                                    </small>
                                <% } %>
                            </div>
                        </td>
                        <td>
                            <%= new Date(product.updatedAt).toLocaleString() %>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="updateStock('<%= product._id %>')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="viewHistory('<%= product._id %>')">
                                <i class="fas fa-history"></i>
                            </button>
                        </td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
</div>

<!-- Add these helper functions to your EJS locals -->
<%
function getStockClass(stock) {
    if (stock === 0) return 'out-of-stock';
    if (stock <= 10) return 'low-stock';
    return '';
}

function getStockBadgeClass(stock) {
    if (stock === 0) return 'badge-danger';
    if (stock <= 10) return 'badge-warning';
    return 'badge-success';
}

function getStockStatus(stock) {
    if (stock === 0) return 'Out of Stock';
    if (stock <= 10) return 'Low Stock';
    return 'In Stock';
}

function getStockTextClass(stock) {
    if (stock === 0) return 'text-danger';
    if (stock <= 10) return 'text-warning';
    return 'text-success';
}
%>
          </main>
            </div>
        </div>
        <script src="js/jquery.min.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="js/scripts.js"></script>   
        <script>
            let isProcessing = false;

// Filter functions
function filterByStock(type) {
    document.getElementById('stockStatus').value = type;
    filterInventory();
}

function filterInventory() {
    const stockStatus = document.getElementById('stockStatus').value;
    const categoryId = document.getElementById('categoryFilter').value;
    const searchQuery = document.getElementById('inventorySearch').value.trim();

    // Show loading state
    document.querySelector('.inventory-table').style.opacity = '0.6';

    // Build query string
    let queryParams = new URLSearchParams({
        stock: stockStatus,
        category: categoryId,
        search: searchQuery
    });

    // Redirect with filters
    window.location.href = `/admin/inventory?${queryParams.toString()}`;
}
        </script>
    </body>
</html>
