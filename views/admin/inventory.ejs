<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description-gambolthemes" content="">
		<meta name="author-gambolthemes" content="">
		<title>Fairway Supermarket Admin</title>
		<link href="css/styles.css" rel="stylesheet">
		<link href="css/admin-style.css" rel="stylesheet">
		<link href="css/admin-custom" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<link  href="/admin/css/inventory.css"  rel="stylesheet">
		<style>
			
			</style>
		
		<!-- Vendor Stylesheets -->
		<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
		
	</head>

    <body class="sb-nav-fixed">
		<%- include('../partials/admin/topnav') %>
        <div id="layoutSidenav">
			<%- include('../partials/admin/sidebar') %>
            <div id="layoutSidenav_content">
                <main>
					<div class="container-fluid">
						<h2 class="mt-30 page-title">Inventory</h2>
						<ol class="breadcrumb mb-30">
							<li class="breadcrumb-item"><a href="/admin/dashboard">Dashboard</a></li>
							<li class="breadcrumb-item active">Inventory</li>
						</ol>
					
						<div class="container-fluid">
                            <!-- Inventory Stats -->
                            <div class="row mb-4">
                                <div class="col-xl-3 col-sm-6">
                                    <div class="stats-card">
                                        <div class="stats-content">
                                            <h3><%= totalProducts %></h3>
                                            <p>Total Products</p>
                                        </div>
                                        <div class="stats-icon">
                                            <i class="fas fa-box"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-sm-6">
                                    <div class="stats-card warning">
                                        <div class="stats-content">
                                            <h3><%= lowStockProducts %></h3>
                                            <p>Low Stock Items</p>
                                        </div>
                                        <div class="stats-icon">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-sm-6">
                                    <div class="stats-card danger">
                                        <div class="stats-content">
                                            <h3><%= outOfStockProducts %></h3>
                                            <p>Out of Stock</p>
                                        </div>
                                        <div class="stats-icon">
                                            <i class="fas fa-times-circle"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-sm-6">
                                    <div class="stats-card success">
                                        <div class="stats-content">
                                            <h3><%= categories.length %></h3>
                                            <p>Categories</p>
                                        </div>
                                        <div class="stats-icon">
                                            <i class="fas fa-tags"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Inventory Table -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="card-title">Inventory Management</h5>
                                        <div class="header-actions">
                                            <button class="btn btn-outline-primary me-2" onclick="exportInventory()">
                                                <i class="fas fa-download"></i> Export
                                            </button>
                                            <button class="btn btn-primary" onclick="openBulkUpdateModal()">
                                                <i class="fas fa-upload"></i> Bulk Update
                                            </button>
                                        </div>
                                    </div>
                                    <div class="filter-section mt-3">
                                        <div class="row g-3">
                                            <div class="col-md-3">
                                                <input type="text" class="form-control" id="searchInput" 
                                                       placeholder="Search products..." onkeyup="filterProducts()">
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-select" id="categoryFilter" onchange="filterProducts()">
                                                    <option value="">All Categories</option>
                                                    <% categories.forEach(category => { %>
                                                        <option value="<%= category._id %>"><%= category.name %></option>
                                                    <% }); %>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-select" id="stockFilter" onchange="filterProducts()">
                                                    <option value="">All Stock Status</option>
                                                    <option value="inStock">In Stock</option>
                                                    <option value="lowStock">Low Stock</option>
                                                    <option value="outOfStock">Out of Stock</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Product</th>
                                                    <th>Category</th>
                                                    <th>Stock</th>
                                                    <th>Price</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% products.forEach(product => { %>
                                                    <tr>
                                                        <td>
                                                            <div class="product-cell">
                                                                <img src="<%= product.images[0] %>" alt="<%= product.name %>">
                                                                <div class="product-info">
                                                                    <h6><%= product.name %></h6>
                                                                    <small><%= product.quantity + product.unit %></small>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td><%= product.category.name %></td>
                                                        <td>
                                                            <div class="stock-cell">
                                                                <span class="stock-count"><%= product.stock %></span>
                                                                <div class="quick-update">
                                                                    <button class="btn btn-sm btn-light" 
                                                                            onclick="quickUpdateStock('<%= product._id %>', 'decrease')">
                                                                        <i class="fas fa-minus"></i>
                                                                    </button>
                                                                    <button class="btn btn-sm btn-light"
                                                                            onclick="quickUpdateStock('<%= product._id %>', 'increase')">
                                                                        <i class="fas fa-plus"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        
                                                        <td>â‚¹<%= product.price.toFixed(2) %></td>
                                                        <td>
                                                            <span class="status-badge">
                                                                <%= (product.stock) %>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <div class="action-buttons">
                                                                <button class="btn btn-sm btn-info" 
                                                                        onclick="viewStockHistory('<%= product._id %>')">
                                                                    <i class="fas fa-history"></i>
                                                                </button>
                                                                <button class="btn btn-sm btn-primary"
                                                                        onclick="updateStock('<%= product._id %>')">
                                                                    <i class="fas fa-edit"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                <% }); %>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                            
          </main>
            </div>
        </div>
        <script src="js/jquery.min.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="js/scripts.js"></script>   
        <script>
          // Filter products
          function filterProducts() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const category = document.getElementById('categoryFilter').value;
    const stockStatus = document.getElementById('stockFilter').value;

    const rows = document.querySelectorAll('tbody tr');
    rows.forEach(row => {
        let show = true;
        const productName = row.querySelector('.product-info h6').textContent.toLowerCase();
        const productCategory = row.querySelector('td:nth-child(2)').textContent;
        const stock = parseInt(row.querySelector('.stock-count').textContent);

        // Search filter
        if (search && !productName.includes(search)) {
            show = false;
        }

        // Category filter
        if (category && row.dataset.category !== category) {
            show = false;
        }

        // Stock status filter
        if (stockStatus) {
            switch(stockStatus) {
                case 'inStock':
                    if (stock <= 10) show = false;
                    break;
                case 'lowStock':
                    if (stock === 0 || stock > 10) show = false;
                    break;
                case 'outOfStock':
                    if (stock > 0) show = false;
                    break;
            }
        }

        row.style.display = show ? '' : 'none';
    });
}

        </script>
    </body>
</html>
